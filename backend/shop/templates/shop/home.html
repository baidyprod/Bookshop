{% extends 'base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/shop/home.css' %}">

    {% if messages %}
        <div class="alert alert-success">
            <ul class="list-unstyled">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    <div class="row mb-3">
    <form class="form-inline" method="get" action="{% url 'home' %}">
        {{ search_form.search_query }}
        <br>
        {{ filter_form.as_p }}
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
    </div>

    <div>
        {% if books %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for book in books %}
                        <tr>
                            <td class="align-middle">{{ book.title }}</td>
                            <td class="align-middle">${{ book.price }}</td>
                            <td class="align-middle">{{ book.quantity }}</td>
                            <td>
                                {% if user.is_authenticated %}
                                    <a class="btn btn-warning btn-sm" href="{% url 'cart_add' book.id %}?{{ request.GET.urlencode }}">Add to Cart</a>
                                {% else %}
                                    <a class="btn btn-warning btn-sm" href="{% url 'register' %}">Add to Cart</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <h2 class="text-center mb-4">No books available</h2>
        {% endif %}
    </div>

    {% if books %}
        <div class="pagination mt-5 mx-auto">
            <ul class="pagination mx-auto">
                <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.number > 1 %}?page=1{% endif %}" aria-label="First">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% endif %}" aria-label="Previous">
                        <span aria-hidden="true">&lt;</span>
                    </a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="?page={{ page_obj.number }}">{{ page_obj.number }}</a>
                </li>
                <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% endif %}" aria-label="Next">
                        <span aria-hidden="true">&gt;</span>
                    </a>
                </li>
                <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.number < page_obj.paginator.num_pages %}?page={{ page_obj.paginator.num_pages }}{% endif %}" aria-label="Last">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </div>
    {% endif %}
{% endblock %}
